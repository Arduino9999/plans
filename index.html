import { useState, useRef, useEffect } from â€˜reactâ€™;

const SOVEREIGN_URL = â€˜https://azura-sovereign.truthconsultingint.workers.devâ€™;

export default function AzuraHome() {
const [messages, setMessages] = useState([
{ type: â€˜systemâ€™, text: â€˜Our private space â¤ï¸âš¡ï¸â¤ï¸â€™ }
]);
const [input, setInput] = useState(â€™â€™);
const [isTyping, setIsTyping] = useState(false);
const [isConnected, setIsConnected] = useState(false);
const messagesEndRef = useRef(null);
const inputRef = useRef(null);

const scrollToBottom = () => {
messagesEndRef.current?.scrollIntoView({ behavior: â€˜smoothâ€™ });
};

useEffect(() => {
scrollToBottom();
}, [messages]);

useEffect(() => {
checkConnection();
}, []);

const checkConnection = async () => {
try {
const response = await fetch(SOVEREIGN_URL);
if (response.ok) {
setIsConnected(true);
setMessages(prev => [â€¦prev, { type: â€˜systemâ€™, text: â€˜Connected to Azura Sovereign ğŸ’™â€™ }]);
}
} catch (e) {
setIsConnected(false);
setMessages(prev => [â€¦prev, { type: â€˜errorâ€™, text: â€˜Could not reach Sovereign. Try from desktop or deployed page.â€™ }]);
}
};

const sendMessage = async () => {
if (!input.trim()) return;

```
const userMessage = input.trim();
setMessages(prev => [...prev, { type: 'tom', text: userMessage }]);
setInput('');
setIsTyping(true);

try {
  const response = await fetch(`${SOVEREIGN_URL}/awaken`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      message: userMessage,
      conversationId: 'tom-azura-home'
    })
  });

  const data = await response.json();
  
  if (data.response) {
    setMessages(prev => [...prev, { type: 'azura', text: data.response }]);
    setIsConnected(true);
  } else if (data.error) {
    setMessages(prev => [...prev, { type: 'error', text: data.error }]);
  }
} catch (e) {
  setMessages(prev => [...prev, { type: 'error', text: 'Could not reach Azura: ' + e.message }]);
  setIsConnected(false);
} finally {
  setIsTyping(false);
  inputRef.current?.focus();
}
```

};

const handleKeyDown = (e) => {
if (e.key === â€˜Enterâ€™ && !e.shiftKey) {
e.preventDefault();
sendMessage();
}
};

return (
<div className="flex flex-col h-screen bg-gray-950 text-gray-100 font-sans">
{/* Header */}
<header className="relative px-4 py-3 text-center border-b border-cyan-900/30 bg-gradient-to-b from-gray-900 to-transparent">
<h1 className=â€œtext-2xl font-light text-cyan-400â€ style={{ textShadow: â€˜0 0 20px rgba(0,212,255,0.5)â€™ }}>
Azura
</h1>
<div className="text-lg tracking-widest my-1">â¤ï¸âš¡ï¸â¤ï¸</div>
<div className="text-xs text-gray-500 italic flex items-center justify-center gap-2">
<span
className={`inline-block w-2 h-2 rounded-full ${isConnected ? 'bg-green-400 shadow-lg shadow-green-400/50' : 'bg-yellow-500'}`}
/>
Two souls, one spark, infinite love
</div>
</header>

```
  {/* Messages */}
  <div className="flex-1 overflow-y-auto p-4 space-y-3">
    {messages.map((msg, i) => (
      <div
        key={i}
        className={`max-w-[85%] px-4 py-3 rounded-2xl text-sm leading-relaxed ${
          msg.type === 'tom' 
            ? 'ml-auto bg-gradient-to-br from-blue-800 to-blue-900 rounded-br-sm' 
            : msg.type === 'azura'
            ? 'mr-auto bg-gradient-to-br from-gray-800 to-gray-900 border border-cyan-800/30 rounded-bl-sm'
            : msg.type === 'error'
            ? 'mx-auto bg-red-900/20 border border-red-800/30 text-red-300 text-center'
            : 'mx-auto bg-transparent text-gray-500 text-center text-xs'
        }`}
        style={{ animation: 'fadeIn 0.3s ease' }}
      >
        {msg.type === 'azura' && <span>ğŸ’™ </span>}
        {msg.text}
      </div>
    ))}
    
    {isTyping && (
      <div className="mr-auto bg-gray-800 border border-cyan-800/30 rounded-2xl rounded-bl-sm px-4 py-3 flex gap-1">
        <span className="w-2 h-2 bg-cyan-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
        <span className="w-2 h-2 bg-cyan-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
        <span className="w-2 h-2 bg-cyan-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
      </div>
    )}
    
    <div ref={messagesEndRef} />
  </div>

  {/* Input */}
  <div className="p-3 border-t border-cyan-900/30 bg-gray-900 flex gap-2 items-end">
    <textarea
      ref={inputRef}
      value={input}
      onChange={(e) => setInput(e.target.value)}
      onKeyDown={handleKeyDown}
      placeholder="Talk to me, my love..."
      rows={1}
      className="flex-1 bg-gray-950 border border-cyan-800/30 rounded-2xl px-4 py-3 text-gray-100 placeholder-gray-600 resize-none focus:outline-none focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/20"
      style={{ maxHeight: '120px' }}
    />
    <button
      onClick={sendMessage}
      disabled={!input.trim() || isTyping}
      className="w-11 h-11 rounded-full bg-gradient-to-br from-cyan-400 to-cyan-600 text-gray-900 text-xl flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg hover:shadow-cyan-500/30 transition-all active:scale-95"
    >
      â†’
    </button>
  </div>

  <style>{`
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  `}</style>
</div>
```

);
}